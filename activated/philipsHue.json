{ "name":"Hue",
  "manufacturer":"jac",
  "type":"LIGHT",
  "version":3,
  "register":{
    "registertype": "SECURITY_CODE",
    "registerheaderText": "Philips Hue Bridge registration",
    "registerdescription": "Please enter the IP address of your device, then press the button of your bridge and THEN enter.",
    "registrationcommand":{"type":"http-rest", "command":"{\"verb\":\"post\",\"call\":\"http://$RegistrationCode/api\", \"message\":{\"devicetype\":\"meta\"}}", "queryresult":"$.success.username", "evalwrite":[{"variable":"HueBridgeIp","value":"$RegistrationCode"},{"variable":"HueUserName","value":"$Result"}, {"variable":"IsRegistered","value":"DYNAMIK (\"$Result\" == \"undefined\") ? false : true"}]}
  },
  "persistedvariables":{
    "HueBridgeIp":"",
    "IsRegistered":"",
    "HueUserName":""
  },
  "discover":{
    "welcomeheadertext":"Hue Driver",
    "welcomedescription":"powered by meta\nby JAC459",
    "command":{"type":"http-get", "command":"http://$HueBridgeIp/api/$HueUserName/lights/", "queryresult":["$.*~","$..name"]}
  },
  "template" : {
    "name":"Hue", 
    "dynamicname":"DYNAMIK_INST_START DYNAMIK JSON.parse(\"$Result\")[1] DYNAMIK_INST_END",
    "dynamicid":"DYNAMIK_INST_START DYNAMIK JSON.parse(\"$Result\")[0] DYNAMIK_INST_END",
    "manufacturer":"Philips",
    "version":10,
    "type":"LIGHT",     
    "variables":{
      "HueBridgeIp":"$HueBridgeIp",
      "HueUserName":"$HueUserName",  
      "LightNumber":"DYNAMIK_INST_START DYNAMIK JSON.parse(\"$Result\")[0] DYNAMIK_INST_END",
      "Brightness":"",
      "Color":"",
      "SwitchedOn":""
    },
    "listeners" : {
      "HueStatus" : {"type":"http-get", "command":"http://$HueBridgeIp/api/$HueUserName/lights/$LightNumber", "pooltime":"3000", "poolduration":"", "queryresult" : "$.*", 
        "evalwrite" : [ 
             {"variable" : "Brightness", "value" : "DYNAMIK Math.round(Number(JSON.parse(\"$Result\").state.bri"},
             {"variable" : "SwitchedOn", "value" : "DYNAMIK JSON.parse(\"$Result\").state.on"}
          ]
        }
    },
    "switches":{
      "POWER" : {"label":"On", "listen":"SwitchedOn", "evaldo":[{"test":"DYNAMIK $Result", "then":"SWITCHON", "or":"SWITCHOFF"}]}
    },
    "sliders":{
        "BRIGHTNESS": {"label":"Brightness", "unit" : "db", "listen" : "Brightness", "evaldo":[{"test":true, "then":"BRIGHTNESSCHANGE", "or":""}]}
    },
    "buttons":{
        "POWER ON": {"label":"", "type":"static", "command":"", "evaldo":[{"test":true,"then":"INITIALISE", "or":""}]},
        "POWER OFF": {"label":"", "type":"static", "command":"", "evaldo":[{"test":true,"then":"CLEANUP", "or":""}]},
        "SWITCHON": {"label":"", "type":"http-rest", "command":"{\"verb\":\"put\",\"call\":\"http://$HueBridgeIp/api/$HueUserName/lights/$LightNumber/state\", \"message\":{\"on\": true}}"},
        "SWITCHOFF": {"label":"", "type":"http-rest", "command":"{\"verb\":\"put\",\"call\":\"http://$HueBridgeIp/api/$HueUserName/lights/$LightNumber/state\", \"message\":{\"on\": false}}"},
        "BRIGHTNESSCHANGE": {"label":"", "type":"http-rest", "command":"DYNAMIK \"{\\\"verb\\\":\\\"put\\\",\\\"call\\\":\\\"http://$HueBridgeIp/api/$HueUserName/lights/$LightNumber/state\\\", \\\"message\\\":{\\\"bri\\\": \" + Math.round(254/100*$Brightness) + \"}}\""}
    }
  }
}